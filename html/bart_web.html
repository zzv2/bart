<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<title>ROS Bart Web Interface</title>
	<!-- <script type="text/javascript" src="../dist/opentype.js"></script> -->
	<script type="text/javascript" src="../dist/eventemitter2.min.js"></script>
	<script type="text/javascript" src="../dist/roslib.min.js"></script>
	<script src="../dist/jquery.min.js"></script>
	<style></style>
</head>
<body>
<div class="container">
	<!-- <form action="" onsubmit="connect()" id="connectForm">
		<div>
			IP:
			<input required pattern="^([0-9]{1,3}\.){3}[0-9]{1,3}$" type="text" id="ip">
		</div>
	</form> -->

	<form action="" onsubmit="join()" id="joinForm">
		<div>
			Name:
			<input type="text" id="name">
			Seat:
			<input type="number" id="seat" min="1" max="10" value="1">
			Color:
			<input type="text" id="color">
			<input type="submit" value="Join">

			<!-- <input type="number" id="fontsize" min="10" max="2048" value="110"> -->
			<!-- Speed (m/s): -->
			<!-- <input type="number" id="speed" min="0.00" max=".10" value=".02" step=".005"> -->
		</div>
	</form>
</div>

<script>
	$("#joinForm").submit(function(event) {
		event.preventDefault(); 
	});

	$("#connectForm").submit(function(event) {
		event.preventDefault(); 
		});

	var ip = prompt("ROS IP", window.location.hostname);
	var url = "ws://"+ip+":9090";

	var ros = new ROSLIB.Ros({
		url : url
	});

	ros.on('connection', function() {
		console.log('Connected to websocket server.');
	});

	ros.on('error', function(error) {
		console.log('Error connecting to websocket server: ', error);
	});

	ros.on('close', function() {
		console.log('Connection to websocket server closed.');
	});

	var cmd_pub = new ROSLIB.Topic({
		ros : ros,
		name : 'bart/cmd',
		messageType : 'bart/Cmd'
	});

	function join() {
		console.log("Join")
		name = document.getElementById("name").value;
		seat = parseInt(document.getElementById("seat").value);
		color = document.getElementById("color").value;
		// color = parseFloat(document.getElementById("speed").value);
		var joinMsg = createCmdMsg("J", name, seat, color);
		cmd_pub.publish(joinMsg);
	}

	function createCmdMsg(type, name, seat, color) {
		return new ROSLIB.Message({
			type : type,
			name : name,
			seat : seat,
			color : color
		});
	}

</script>
</body>
</html>
